<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Brewer">
<meta name="dcterms.date" content="2024-11-16">

<title>GEOG 6960 Causality in Geog. Studies 6</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#coding-sems" id="toc-coding-sems" class="nav-link" data-scroll-target="#coding-sems">Coding SEMs</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example 1</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#creating-a-structural-equation-model" id="toc-creating-a-structural-equation-model" class="nav-link" data-scroll-target="#creating-a-structural-equation-model">Creating a structural equation model</a></li>
  </ul></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2</a>
  <ul class="collapse">
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#dag" id="toc-dag" class="nav-link" data-scroll-target="#dag">DAG</a></li>
  </ul></li>
  <li><a href="#appendix-data-files" id="toc-appendix-data-files" class="nav-link" data-scroll-target="#appendix-data-files">Appendix: Data files</a>
  <ul class="collapse">
  <li><a href="#grace-and-keely-dataset-keeley.csv" id="toc-grace-and-keely-dataset-keeley.csv" class="nav-link" data-scroll-target="#grace-and-keely-dataset-keeley.csv">Grace and Keely dataset <em>keeley.csv</em></a></li>
  <li><a href="#mosquito-net-usage-dataset-mosquito_nets.csv" id="toc-mosquito-net-usage-dataset-mosquito_nets.csv" class="nav-link" data-scroll-target="#mosquito-net-usage-dataset-mosquito_nets.csv">Mosquito net usage dataset <em>mosquito_nets.csv</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GEOG 6960 Causality in Geog. Studies 6</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Simon Brewer <a href="mailto:simon.brewer@ess.utah.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Utah
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 16, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, we’re going to explore how to build and test structural equation models (SEMs). We’ll use two examples: - The Grace and Keeley fire/plant abundance dataset (<em>keeley.csv</em>) - The mosquito net usage dataset (<em>mosquito_nets.csv</em>)</p>
</section>
<section id="coding-sems" class="level2">
<h2 class="anchored" data-anchor-id="coding-sems">Coding SEMs</h2>
<p>Both R and Python have packages that allow you to create SEMs and estimate coefficients based on a dataset.</p>
<ul>
<li>R: <strong>lavaan</strong> and <strong>sem</strong></li>
<li>Python: <strong>semopy</strong> (<code>pip install semopy</code>)</li>
</ul>
<p>First load (or install and load) the relevant packages. We’ll need some additional packages to explore the data before model building.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaanPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> semopy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="example-1" class="level2">
<h2 class="anchored" data-anchor-id="example-1">Example 1</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Let’s start by loading the Grace and Keeley dataset and exploring the values. There are (or should be) 8 variables (described in the appendix below). Note that this differs a little from the dataset used in the paper - there is an additional field (<code>elev</code>) which we will drop, and the community type variable is missing. Later, we’ll adjust the DAG that we use as a basis for the model accordingly.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/keeley.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> keeley <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>elev)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   90 obs. of  7 variables:
 $ distance: num  53.4 37 53.7 53.7 52 ...
 $ abiotic : num  60.7 40.9 51 61.2 46.7 ...
 $ age     : int  40 25 15 15 23 24 35 14 45 35 ...
 $ hetero  : num  0.757 0.491 0.844 0.691 0.546 ...
 $ firesev : num  3.5 4.05 2.6 2.9 4.3 4 4.8 4.8 7.25 6.2 ...
 $ cover   : num  1.039 0.478 0.949 1.195 1.298 ...
 $ rich    : int  51 31 71 64 68 34 39 66 25 31 ...</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="op">=</span> pd.read_csv(<span class="st">"./data/keeley.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>keeley.drop(<span class="st">'elev'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>keeley.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        distance    abiotic        age  ...    firesev      cover       rich
count  90.000000  90.000000  90.000000  ...  90.000000  90.000000  90.000000
mean   49.234583  49.239025  25.566667  ...   4.565000   0.691232  49.233333
std     8.829480   7.679109  12.566274  ...   1.652347   0.317235  15.105658
min    37.037450  32.593865   3.000000  ...   1.200000   0.055577  15.000000
25%    39.459800  43.812007  15.000000  ...   3.700000   0.487690  37.000000
50%    51.770850  48.036046  25.000000  ...   4.300000   0.637118  50.000000
75%    58.402237  54.898285  35.000000  ...   5.550000   0.914676  62.000000
max    60.723000  70.456286  60.000000  ...   9.200000   1.535408  85.000000

[8 rows x 7 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Let’s take a quick look at the distribution of the variables in the file. These are generally normally distributed (or at least close enough for our purposes). The one exception is the distance to coast variable which shows three clusters of plots.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="860"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="1680"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We can also take a look at the covariance matrix based on the set of variables. (As a reminder, this is what our SEM will be trying to reproduce.)</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            distance     abiotic         age       hetero      firesev
distance  77.9597236  31.1704086 -30.8610652  0.350756757 -4.054309551
abiotic   31.1704086  58.9687166 -12.9148310  0.243915311 -2.681293440
age      -30.8610652 -12.9148310 157.9112360 -0.138245879  9.423988764
hetero     0.3507568   0.2439153  -0.1382459  0.013183203 -0.009932791
firesev   -4.0543096  -2.6812934   9.4239888 -0.009932791  2.730250000
cover      0.6819166   0.2988236  -1.3968842 -0.006133045 -0.229138017
rich      77.9547539  58.9674057 -57.3359551  0.792607436 -9.180505618
                cover        rich
distance  0.681916629  77.9547539
abiotic   0.298823649  58.9674057
age      -1.396884159 -57.3359551
hetero   -0.006133045   0.7926074
firesev  -0.229138017  -9.1805056
cover     0.100637887   1.5772673
rich      1.577267311 228.1808989</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>keeley.cov()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           distance    abiotic         age  ...   firesev     cover        rich
distance  77.959724  31.170409  -30.861065  ... -4.054310  0.681917   77.954754
abiotic   31.170409  58.968717  -12.914831  ... -2.681293  0.298824   58.967406
age      -30.861065 -12.914831  157.911236  ...  9.423989 -1.396884  -57.335955
hetero     0.350757   0.243915   -0.138246  ... -0.009933 -0.006133    0.792607
firesev   -4.054310  -2.681293    9.423989  ...  2.730250 -0.229138   -9.180506
cover      0.681917   0.298824   -1.396884  ... -0.229138  0.100638    1.577267
rich      77.954754  58.967406  -57.335955  ... -9.180506  1.577267  228.180899

[7 rows x 7 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="creating-a-structural-equation-model" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-structural-equation-model">Creating a structural equation model</h3>
<p>We’ll start by creating a subset model (the same one we looked at in class). This will only use three variables (<code>age</code>, <code>firesev</code> and <code>cover</code>). These are related by the following DAG:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Building a structural equation model usually takes two steps. First, we need to describe the DAG that relates the variables, and second, we use a dataset to estimate values for the paths and other parameters.</p>
<section id="modeldag-description" class="level4">
<h4 class="anchored" data-anchor-id="modeldag-description">Model/DAG description</h4>
<p>Both <strong>lavaan</strong> and <strong>semopy</strong> use a similar syntax to describe the model, based on R’s formula syntax. For each endogenous variable (one that has at least one arrow <em>coming in</em> to it) in the graph, we need a formula to describe the paths. This is written as:</p>
<pre><code>y ~ x1 + x2 + ...</code></pre>
<p>Where <code>y</code> is the variable of interest, and <code>x1</code>, <code>x2</code>, etc are all variables that are at the origin of the path flowing into <code>y</code>. For the DAG above, we need a formula for fire severity (<code>firesev</code>) and plant cover (<code>cover</code>). We do not need one for stand age as there are no incoming arrows in this DAG. The set of formula are specified as a character string. Note that the name of the variables in the formula need to exactly match the names of the data frame column that hold that variable.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>In R, these are generally written as one formula per line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="ot">=</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="st">'firesev ~ age</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">cover ~ age + firesev</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>In Python, these are concatenated into a single line with line returns (<code>\n</code>) to separate the formula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="op">=</span> <span class="st">'firesev ~ age</span><span class="ch">\n</span><span class="st">cover ~ age + firesev'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="model-fitting" class="level4">
<h4 class="anchored" data-anchor-id="model-fitting">Model fitting</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>In R, the function is <code>sem()</code>. This needs a minimum of two arguments: the model formula and the data frame containing the variables of interest. We also use the argument <code>meanstructure = TRUE</code> to return the intercepts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>keeley_sem1 <span class="ot">&lt;-</span> <span class="fu">sem</span>(keeley_formula, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> keeley,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">meanstructure =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p><code>semopy</code> follows the standard Python approach of first instantiating the semopy model with the formula, then fiting it using the <code>keeley</code> dataframe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> semopy.Model(keeley_formula)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now let’s explore the output.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(keeley_sem1, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">standardize =</span> <span class="cn">TRUE</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">rsq =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         7

  Number of observations                            90

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
  firesev ~                                                             
    age               0.060    0.012    4.832    0.000    0.060    0.454
  cover ~                                                               
    age              -0.005    0.003   -1.833    0.067   -0.005   -0.191
    firesev          -0.067    0.020   -3.353    0.001   -0.067   -0.350

Intercepts:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .firesev           3.039    0.351    8.647    0.000    3.039    1.850
   .cover             1.122    0.090   12.398    0.000    1.122    3.556

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .firesev           2.144    0.320    6.708    0.000    2.144    0.794
   .cover             0.078    0.012    6.708    0.000    0.078    0.780

R-Square:
                   Estimate
    firesev           0.206
    cover             0.220</code></pre>
</div>
</div>
<p>There’s quite a lot of output in the model summary. The various sections (from the top) are:</p>
<ul>
<li>Model fitting details: the fitting and optimization method and the number of parameters estimated</li>
<li>Model test: the results of the Chi-squared test for goodness-of-fit</li>
<li>Parameter estimates: settings for parameter estimates (incl.&nbsp;standard errors)</li>
<li>Regressions: the path coefficients. For each one, there is
<ul>
<li>The estimate</li>
<li>The standard error</li>
<li>The estimate as a <span class="math inline">\(z\)</span>-score</li>
<li>The <span class="math inline">\(p\)</span>-value</li>
<li>The estimate standardized for any latent variables (we don’t have any)</li>
<li>The standardized coefficient. This is the coefficient we would obtain if all the variables were <span class="math inline">\(z\)</span>-score transformed, and allows comparison between the strength of the different paths</li>
</ul></li>
<li>Intercepts: estimate of intercept/mean values for each endogenous variable. The columns are the same as the previous table</li>
<li>Variances: the estimate variance of the endogenous variables</li>
<li>R-Square: the <span class="math inline">\(r\)</span>-squared value for each endogenous variable (how much of the variance of that variable was explained)</li>
</ul>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p>Once fit, the original model contains details of the fitting process (aglorithm, optimizer, etc):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name of objective: MLW
Optimization method: SLSQP
Optimization successful.
Optimization terminated successfully
Objective value: 0.000
Number of iterations: 13
Params: 0.060 -0.005 -0.067 0.078 2.145</code></pre>
</div>
</div>
<p>The estimated model parameters, as well as standard errors and <span class="math inline">\(p\)</span>-values, are in the fitted model object. Path coefficients are noted with <code>~</code> and variable variance is noted with <code>~~</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mod.inspect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lval  op     rval  Estimate  Std. Err   z-value       p-value
0  firesev   ~      age  0.059658  0.012353  4.829254  1.370455e-06
1    cover   ~      age -0.004827  0.002637 -1.830613  6.715826e-02
2    cover   ~  firesev -0.067239  0.020052 -3.353280  7.985976e-04
3  firesev  ~~  firesev  2.144768  0.319723  6.708204  1.970335e-11
4    cover  ~~    cover  0.077611  0.011570  6.708204  1.970335e-11</code></pre>
</div>
</div>
<p>Note that the intercepts are not returned by default. You can get these with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> semopy.means <span class="im">import</span> estimate_means</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>estimate_means(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lval op rval   Estimate
0      age  ~    1  25.566667
1  firesev  ~    1   3.039744
2    cover  ~    1   1.121591</code></pre>
</div>
</div>
<p>This returns the intercepts <em>plus</em> the mean of the exogenous variables (<code>age</code> in this example)</p>
</div>
</div>
</div>
</section>
<section id="model-diagnostics" class="level4">
<h4 class="anchored" data-anchor-id="model-diagnostics">Model diagnostics</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>In addition to the summary output, we can access model diagnostics using other functions. Using <code>anova()</code> will run the Chi-squared test comparing this model to a fully saturated model. In this case, the model we have fit is the saturated model, so the Chi-squared cannot be calculated (but see below for a better test):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(keeley_sem1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi-Squared Test Statistic (unscaled)

          Df   AIC   BIC Chisq Chisq diff Df diff Pr(&gt;Chisq)
Saturated  0                 0                              
Model      0 363.4 380.9     0          0       0           </code></pre>
</div>
</div>
<p>You can also obtain the model AIC with, not too surprisingly, the <code>AIC()</code> function. There are several other diagnostics that can be obtained with the <code>fitMeasures</code> function. This produces a large number of different test scores, so we’ll limit it here to the root-mean squared error of approximation (RMSEA), which should ideally be below 0.1. Again, with a saturated model, this is zero and not very meaningful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(keeley_sem1, <span class="fu">c</span>(<span class="st">'rmsea'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rmsea 
    0 </code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>In Python, we can access model diagnostics using the <code>calc_stats</code> function. This produces a large amount of metrics, including the Chi-squared value, CFI, RMSEA, etc</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>semopy.calc_stats(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       DoF  DoF Baseline     chi2  ...   AIC        BIC        LogLik
Value    1             4  0.00002  ...  10.0  22.499048  2.224589e-07

[1 rows x 14 columns]</code></pre>
</div>
</div>
<p>Here’s the results of the Chi-squared test. In this case, the model we have fit is the saturated model, so the Chi-squared cannot be calculated as there are no degrees of freedom. (<code>semopy</code> uses an approximation so the Chi-squared value is not exactly equal to zero.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>semopy.calc_stats(mod)[[<span class="st">'chi2'</span>, <span class="st">'chi2 p-value'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          chi2  chi2 p-value
Value  0.00002       0.99643</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="model-visualization" class="level4">
<h4 class="anchored" data-anchor-id="model-visualization">Model visualization</h4>
<p>An easier way to portray the results is to plot out the DAG with the SEM estimated coefficients on the paths. This should show significant paths between <code>age</code> and <code>firesev</code>, and between <code>firesev</code> and <code>cover</code>, but the direct path from <code>age</code> to <code>cover</code> is not significant.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lavaanPlot</span>(keeley_sem1, <span class="at">coef=</span><span class="cn">TRUE</span>, <span class="at">stars=</span><span class="st">"regress"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/keeley_sem1.png" class="img-fluid figure-img"></p>
<figcaption>lavaanPlot</figcaption>
</figure>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>The <code>semplot()</code> function provides a wrapper to the <code>graphviz</code> library (you will need to have this installed), and can be used to visualize the model. This will render in a Jupyter notebook or as an external file. (Note that <code>g</code> below is a graphviz object and can be modified.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> semopy.semplot(mod, <span class="st">"test.png"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;graphviz.graphs.Digraph object at 0x1750872e0&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="a-simpler-model" class="level4">
<h4 class="anchored" data-anchor-id="a-simpler-model">A simpler model</h4>
<p>As the path between age and cover appears non-significant, we can ask if it is really a necessary part of the model. To do this, we’ll drop the path, rebuild the model and check the results of the Chi-squared test.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="ot">=</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">'firesev ~ age</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">cover ~ firesev</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>keeley_sem2 <span class="ot">&lt;-</span> <span class="fu">sem</span>(keeley_formula, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> keeley,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">meanstructure =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(keeley_sem2, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">standardize =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">rsq =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         6

  Number of observations                            90

Model Test User Model:
                                                      
  Test statistic                                 3.297
  Degrees of freedom                                 1
  P-value (Chi-square)                           0.069

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
  firesev ~                                                             
    age               0.060    0.012    4.832    0.000    0.060    0.454
  cover ~                                                               
    firesev          -0.084    0.018   -4.611    0.000   -0.084   -0.437

Intercepts:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .firesev           3.039    0.351    8.647    0.000    3.039    1.850
   .cover             1.074    0.088   12.166    0.000    1.074    3.406

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .firesev           2.144    0.320    6.708    0.000    2.144    0.794
   .cover             0.081    0.012    6.708    0.000    0.081    0.809

R-Square:
                   Estimate
    firesev           0.206
    cover             0.191</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="op">=</span> <span class="st">'firesev ~ age</span><span class="ch">\n</span><span class="st">cover ~ firesev'</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> semopy.Model(keeley_formula)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(keeley)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>mod.inspect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lval  op     rval  Estimate  Std. Err   z-value       p-value
0  firesev   ~      age  0.059616  0.012352  4.826435  1.389991e-06
1    cover   ~  firesev -0.083902  0.018201 -4.609770  4.031137e-06
2  firesev  ~~  firesev  2.144243  0.319645  6.708204  1.970335e-11
3    cover  ~~    cover  0.080476  0.011997  6.708204  1.970335e-11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>semopy.calc_stats(mod)[[<span class="st">'chi2'</span>, <span class="st">'chi2 p-value'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           chi2  chi2 p-value
Value  3.297465      0.192294</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now we get a value for the Chi-squared test of about 3.3, and a <span class="math inline">\(p\)</span>-value above 0.05, which suggests there is no significant difference between this simpler model and the full covariance matrix. Or to put it more simply, dropping the path from <code>age</code> to <code>cover</code> has not made the model notably worse.</p>
</section>
<section id="the-full-model" class="level4">
<h4 class="anchored" data-anchor-id="the-full-model">The full model</h4>
<p>Now let’s make the full model, detailed in the DAG below:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As before, start by building the paths. Note that, apart from <code>distance</code>, all variables are endogenous and will need a formula.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="ot">=</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="st">age ~ distance</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="st">hetero ~ distance</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="st">abiotic ~ distance</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="st">firesev ~ age</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="st">cover ~ firesev</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="st">rich ~ cover + hetero + abiotic + distance</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="op">=</span> <span class="st">'age ~ distance</span><span class="ch">\n</span><span class="st">hetero ~ distance</span><span class="ch">\n</span><span class="st">abiotic ~ distance</span><span class="ch">\n</span><span class="st">firesev ~ age</span><span class="ch">\n</span><span class="st">cover ~ firesev</span><span class="ch">\n</span><span class="st">rich ~ cover + hetero + abiotic + distance'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now let’s build the model and check how well it fits.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>keeley_sem3 <span class="ot">&lt;-</span> <span class="fu">sem</span>(keeley_formula, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> keeley,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">meanstructure =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: lavaan-&gt;lav_data_full():  
   some observed variances are (at least) a factor 1000 times larger than 
   others; use varTable(fit) to investigate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(keeley_sem3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        21

  Number of observations                            90

Model Test User Model:
                                                      
  Test statistic                                20.866
  Degrees of freedom                                12
  P-value (Chi-square)                           0.052

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  age ~                                               
    distance         -0.396    0.144   -2.747    0.006
  hetero ~                                            
    distance          0.004    0.001    3.498    0.000
  abiotic ~                                           
    distance          0.400    0.081    4.911    0.000
  firesev ~                                           
    age               0.060    0.012    4.832    0.000
  cover ~                                             
    firesev          -0.084    0.018   -4.611    0.000
  rich ~                                              
    cover            13.648    3.405    4.008    0.000
    hetero           44.512   10.012    4.446    0.000
    abiotic           0.491    0.158    3.103    0.002
    distance          0.484    0.145    3.341    0.001

Intercepts:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .age              45.057    7.207    6.252    0.000
   .hetero            0.462    0.064    7.180    0.000
   .abiotic          29.554    4.072    7.258    0.000
   .firesev           3.039    0.351    8.647    0.000
   .cover             1.074    0.088   12.166    0.000
   .rich            -38.616    9.200   -4.198    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .age             144.076   21.478    6.708    0.000
   .hetero            0.011    0.002    6.708    0.000
   .abiotic          45.989    6.856    6.708    0.000
   .firesev           2.144    0.320    6.708    0.000
   .cover             0.081    0.012    6.708    0.000
   .rich            103.534   15.434    6.708    0.000</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> semopy.Model(keeley_formula)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(keeley)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>mod.inspect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lval  op      rval    Estimate   Std. Err   z-value       p-value
0       age   ~  distance   -0.395876   0.144576 -2.738183  6.177962e-03
1    hetero   ~  distance    0.004499   0.001286  3.498238  4.683427e-04
2   abiotic   ~  distance    0.399777   0.081389  4.911938  9.018049e-07
3   firesev   ~       age    0.059678   0.012313  4.846912  1.253983e-06
4     cover   ~   firesev   -0.083934   0.018190 -4.614244  3.945291e-06
5      rich   ~     cover   13.626100   3.417470  3.987189  6.686079e-05
6      rich   ~    hetero   44.282423  10.049588  4.406392  1.051067e-05
7      rich   ~   abiotic    0.491382   0.158800  3.094346  1.972476e-03
8      rich   ~  distance    0.485038   0.145445  3.334848  8.534589e-04
9   abiotic  ~~   abiotic   45.961067   6.851471  6.708204  1.970335e-11
10      age  ~~       age  145.028612  21.619589  6.708204  1.970335e-11
11    cover  ~~     cover    0.080498   0.012000  6.708204  1.970335e-11
12  firesev  ~~   firesev    2.143627   0.319553  6.708204  1.970335e-11
13   hetero  ~~    hetero    0.011476   0.001711  6.708204  1.970335e-11
14     rich  ~~      rich  104.311698  15.549870  6.708204  1.970335e-11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>semopy.calc_stats(mod)[[<span class="st">'chi2'</span>, <span class="st">'chi2 p-value'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            chi2  chi2 p-value
Value  20.871316      0.075513</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The goodness-of-fit value indicates that this model fits well (i.e.&nbsp;<span class="math inline">\(p&gt;0.05\)</span>), but it is close to the threshold. We can explore which of the missing paths may be the most useful to include to improve the fit by calculating the modification indices. These indicate the change in Chi-squared value if a path was included in the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<p>In R, we can calculate these with <code>modificationIndices</code>. We’ll get these, sort for the largest index and print the top 5</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modificationIndices</span>(keeley_sem3) <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>mi) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lhs op    rhs    mi    epc sepc.lv sepc.all sepc.nox
1   hetero ~~  cover 6.889 -0.008  -0.008   -0.277   -0.277
2   hetero  ~  cover 6.544 -0.092  -0.092   -0.253   -0.253
3    cover  ~ hetero 4.078 -0.529  -0.529   -0.192   -0.192
4 distance  ~  cover 3.404  5.592   5.592    0.201    0.201
5  firesev  ~  cover 3.238  2.157   2.157    0.414    0.414</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p>The semopy package unfortunately does not currently have a function to calculate these.</p>
</div>
</div>
</div>
<p>The path with the largest impact on the Chi-squared value is between <code>cover</code> and <code>hetero</code>. Physically, the most likely direction for this is that heterogeneity causally affects cover, so we’ll include that (<code>cover ~ firesev + hetero</code>) and update this model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="ot">=</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="st">age ~ distance</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="st">hetero ~ distance</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="st">abiotic ~ distance</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="st">firesev ~ age</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="st">cover ~ firesev + hetero</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="st">rich ~ cover + hetero + abiotic + distance</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>keeley_sem4 <span class="ot">&lt;-</span> <span class="fu">sem</span>(keeley_formula, </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> keeley,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">meanstructure =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: lavaan-&gt;lav_data_full():  
   some observed variances are (at least) a factor 1000 times larger than 
   others; use varTable(fit) to investigate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(keeley_sem4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6-19 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        22

  Number of observations                            90

Model Test User Model:
                                                      
  Test statistic                                16.690
  Degrees of freedom                                11
  P-value (Chi-square)                           0.117

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  age ~                                               
    distance         -0.396    0.144   -2.747    0.006
  hetero ~                                            
    distance          0.004    0.001    3.498    0.000
  abiotic ~                                           
    distance          0.400    0.081    4.911    0.000
  firesev ~                                           
    age               0.060    0.012    4.832    0.000
  cover ~                                             
    firesev          -0.086    0.018   -4.823    0.000
    hetero           -0.530    0.256   -2.069    0.039
  rich ~                                              
    cover            13.648    3.454    3.952    0.000
    hetero           44.512   10.178    4.373    0.000
    abiotic           0.491    0.158    3.103    0.002
    distance          0.484    0.145    3.340    0.001

Intercepts:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .age              45.057    7.207    6.252    0.000
   .hetero            0.462    0.064    7.180    0.000
   .abiotic          29.554    4.072    7.258    0.000
   .firesev           3.039    0.351    8.647    0.000
   .cover             1.445    0.198    7.286    0.000
   .rich            -38.616    9.560   -4.039    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .age             144.076   21.478    6.708    0.000
   .hetero            0.011    0.002    6.708    0.000
   .abiotic          45.989    6.856    6.708    0.000
   .firesev           2.144    0.320    6.708    0.000
   .cover             0.077    0.011    6.708    0.000
   .rich            103.534   15.434    6.708    0.000</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>keeley_formula <span class="op">=</span> <span class="st">'age ~ distance</span><span class="ch">\n</span><span class="st">hetero ~ distance</span><span class="ch">\n</span><span class="st">abiotic ~ distance</span><span class="ch">\n</span><span class="st">firesev ~ age</span><span class="ch">\n</span><span class="st">cover ~ firesev + hetero</span><span class="ch">\n</span><span class="st">rich ~ cover + hetero + abiotic + distance'</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> semopy.Model(keeley_formula)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> mod.fit(keeley)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>mod.inspect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lval  op      rval    Estimate   Std. Err   z-value       p-value
0       age   ~  distance   -0.395884   0.144581 -2.738148  6.178627e-03
1    hetero   ~  distance    0.004500   0.001286  3.498660  4.676024e-04
2   abiotic   ~  distance    0.399846   0.081395  4.912440  8.994979e-07
3   firesev   ~       age    0.059678   0.012313  4.846534  1.256371e-06
4     cover   ~   firesev   -0.085841   0.017788 -4.825676  1.395294e-06
5     cover   ~    hetero   -0.529902   0.256165 -2.068598  3.858379e-02
6      rich   ~     cover   13.622034   3.466325  3.929821  8.500921e-05
7      rich   ~    hetero   44.276342  10.215595  4.334191  1.462971e-05
8      rich   ~   abiotic    0.491416   0.158783  3.094888  1.968870e-03
9      rich   ~  distance    0.485102   0.145457  3.335023  8.529224e-04
10  abiotic  ~~   abiotic   45.967631   6.852450  6.708204  1.970335e-11
11      age  ~~       age  145.038118  21.621006  6.708204  1.970335e-11
12    cover  ~~     cover    0.076849   0.011456  6.708204  1.970335e-11
13  firesev  ~~   firesev    2.144067   0.319619  6.708204  1.970335e-11
14   hetero  ~~    hetero    0.011476   0.001711  6.708204  1.970335e-11
15     rich  ~~      rich  104.304465  15.548792  6.708204  1.970335e-11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>semopy.calc_stats(mod)[[<span class="st">'chi2'</span>, <span class="st">'chi2 p-value'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            chi2  chi2 p-value
Value  16.694584      0.161452</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/keeley_sem4.png" class="img-fluid figure-img"></p>
<figcaption>lavaanPlot</figcaption>
</figure>
</div>
<p>The new model shows a marginally significant negative relationship between heterogeneity and cover.</p>
</section>
</section>
</section>
<section id="example-2" class="level2">
<h2 class="anchored" data-anchor-id="example-2">Example 2</h2>
<p>For a second example, you’ll build and fit a structural equation model to the mosquito net data that we briefly introduced in the last lab. This is a simulated dataset on how the use of mosquito nets affects the risk of malaria (see appendix for details). Unlike the previous example, you’ll need to work out the code on your own.</p>
<section id="data-1" class="level3">
<h3 class="anchored" data-anchor-id="data-1">Data</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mosquito <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/mosquito_nets.csv"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>mosquito <span class="ot">&lt;-</span> mosquito <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mosquito)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1752 obs. of  9 variables:
 $ net         : logi  TRUE FALSE FALSE TRUE FALSE FALSE ...
 $ net_num     : int  1 0 0 1 0 0 1 0 0 0 ...
 $ malaria_risk: int  33 42 80 34 44 25 19 35 32 40 ...
 $ income      : int  781 974 502 671 728 1050 1146 1093 1037 828 ...
 $ health      : int  56 57 15 20 17 48 65 75 60 36 ...
 $ household   : int  2 4 3 5 5 1 3 5 3 3 ...
 $ eligible    : logi  FALSE FALSE FALSE TRUE FALSE FALSE ...
 $ temperature : num  21.1 26.5 25.6 21.3 19.2 25.3 27.4 29.8 27.6 21.3 ...
 $ resistance  : int  59 73 65 46 54 34 45 65 55 54 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(mosquito)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mosquito, <span class="fu">aes</span>(<span class="at">x =</span> net, <span class="at">y =</span> malaria_risk)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mosquito <span class="op">=</span> pd.read_csv(<span class="st">"./data/mosquito_nets.csv"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>mosquito.drop(<span class="st">'id'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>mosquito.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           net_num  malaria_risk  ...  temperature   resistance
count  1752.000000    1752.00000  ...  1752.000000  1752.000000
mean      0.388699      35.58847  ...    23.813128    47.789384
std       0.487594      15.45673  ...     4.107322    13.857257
min       0.000000      10.00000  ...    15.600000     5.000000
25%       0.000000      24.00000  ...    20.600000    38.000000
50%       0.000000      31.00000  ...    23.800000    48.000000
75%       1.000000      46.00000  ...    26.900000    57.000000
max       1.000000      90.00000  ...    32.200000    95.000000

[8 rows x 7 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(mosquito)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="1106"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" width="2160"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sns.boxplot(mosquito, x<span class="op">=</span><span class="st">"net"</span>, y<span class="op">=</span><span class="st">"malaria_risk"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week6_files/figure-html/unnamed-chunk-44-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="dag" class="level3">
<h3 class="anchored" data-anchor-id="dag">DAG</h3>
<p>Now try to fit the full model as described by the DAG below. Start by creating the set of model formulae. A good first order test is to check that the total number of covariates (across all formulae) equals the number of arrows in the DAG.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mosquito_dag.png" class="img-fluid figure-img"></p>
<figcaption>lavaanPlot</figcaption>
</figure>
</div>
<p>Once you’ve done this, fit and visualize the model then check the Chis-squared test. Does this give a good fit? Are there any missing paths that should be included?</p>
</section>
</section>
<section id="appendix-data-files" class="level1">
<h1>Appendix: Data files</h1>
<section id="grace-and-keely-dataset-keeley.csv" class="level2">
<h2 class="anchored" data-anchor-id="grace-and-keely-dataset-keeley.csv">Grace and Keely dataset <em>keeley.csv</em></h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column header</th>
<th>Variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>distance</td>
<td>Distance to coast (m)</td>
</tr>
<tr class="even">
<td>elev</td>
<td>Elevation a.s.l.</td>
</tr>
<tr class="odd">
<td>abiotic</td>
<td>Abiotic favorability</td>
</tr>
<tr class="even">
<td>age</td>
<td>Age of stand before fire</td>
</tr>
<tr class="odd">
<td>hetero</td>
<td>Plot heterogeneity</td>
</tr>
<tr class="even">
<td>firesev</td>
<td>Severity of fire</td>
</tr>
<tr class="odd">
<td>cover</td>
<td>Cover of plants</td>
</tr>
<tr class="even">
<td>rich</td>
<td>Plant species richness</td>
</tr>
</tbody>
</table>
</section>
<section id="mosquito-net-usage-dataset-mosquito_nets.csv" class="level2">
<h2 class="anchored" data-anchor-id="mosquito-net-usage-dataset-mosquito_nets.csv">Mosquito net usage dataset <em>mosquito_nets.csv</em></h2>
<p>Taken from https://github.com/r-causal/causalworkshop</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Column header</th>
<th>Variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>observation ID</td>
</tr>
<tr class="even">
<td>net</td>
<td>Did the household use nets (F/T)</td>
</tr>
<tr class="odd">
<td>net_num</td>
<td>Did the household use nets (0/1)</td>
</tr>
<tr class="even">
<td>malaria_risk</td>
<td>likelihood that someone in the household will be infected (0-100)</td>
</tr>
<tr class="odd">
<td>income</td>
<td>Monthly income ($)</td>
</tr>
<tr class="even">
<td>health</td>
<td>Self-reported healthiness (0-100)</td>
</tr>
<tr class="odd">
<td>household</td>
<td>Number of people living in the household</td>
</tr>
<tr class="even">
<td>eligible</td>
<td>Eligibility for the free net program (0/1)</td>
</tr>
<tr class="odd">
<td>temperature</td>
<td>Average temperature at night (C)</td>
</tr>
<tr class="even">
<td>resistance</td>
<td>Resistance of mosquito strains to insecticide</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>