<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Brewer">
<meta name="dcterms.date" content="2024-11-17">

<title>GEOG 6960 Causality in Geog. Studies 10</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#bayesian-networks" id="toc-bayesian-networks" class="nav-link" data-scroll-target="#bayesian-networks">Bayesian networks</a></li>
  <li><a href="#discrete-bayesian-networks" id="toc-discrete-bayesian-networks" class="nav-link" data-scroll-target="#discrete-bayesian-networks">Discrete Bayesian Networks</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example 1</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2</a></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">Example 3</a></li>
  <li><a href="#inference-with-bayesian-networks" id="toc-inference-with-bayesian-networks" class="nav-link" data-scroll-target="#inference-with-bayesian-networks">Inference with Bayesian networks</a></li>
  </ul></li>
  <li><a href="#gaussian-bayesian-networks" id="toc-gaussian-bayesian-networks" class="nav-link" data-scroll-target="#gaussian-bayesian-networks">Gaussian Bayesian networks</a>
  <ul class="collapse">
  <li><a href="#structure-learning-3" id="toc-structure-learning-3" class="nav-link" data-scroll-target="#structure-learning-3">Structure learning</a></li>
  <li><a href="#parameter-learning-2" id="toc-parameter-learning-2" class="nav-link" data-scroll-target="#parameter-learning-2">Parameter learning</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  </ul></li>
  <li><a href="#appendix-data-files" id="toc-appendix-data-files" class="nav-link" data-scroll-target="#appendix-data-files">Appendix: Data files</a>
  <ul class="collapse">
  <li><a href="#travel-survey-dataset-survey.txt" id="toc-travel-survey-dataset-survey.txt" class="nav-link" data-scroll-target="#travel-survey-dataset-survey.txt">Travel survey dataset <em>survey.txt</em></a></li>
  <li><a href="#grace-and-keeley-dataset-keeley.csv" id="toc-grace-and-keeley-dataset-keeley.csv" class="nav-link" data-scroll-target="#grace-and-keeley-dataset-keeley.csv">Grace and Keeley dataset <em>keeley.csv</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GEOG 6960 Causality in Geog. Studies 10</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Simon Brewer <a href="mailto:simon.brewer@ess.utah.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Utah
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, we’re going to take a quick look at working with Bayesian networks. These are probabilistic graph models, that overlap with path models and structural equation models. The main difference is that these are based on Bayesian theory, which makes it possible to include prior information and provides probabilistic estimates that can help understand the uncertainty in a model. Note that these are not uniquely causal models - these can be used simply to model the relationships between a set of observations. However, in the absence of confounders (i.e.&nbsp;all known ones are accounted for), then these can be used for causal analysis.</p>
<p>Bayesian networks are developed in two steps: structure learning and parameter learning. Both of these can incorporate expert knowledge, and we’ll see examples of this below.</p>
<p>We’ll use two datasets:</p>
<ul>
<li>Travel survey data</li>
<li>Keeley and Grace fire data set (<em>keeley.csv</em>)</li>
</ul>
</section>
<section id="bayesian-networks" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-networks">Bayesian networks</h2>
<p>Both R and Python have several packages that allow you to create SEMs and estimate coefficients based on a dataset. We’ll use <strong>bnlearn</strong> for R and <strong>pgmpy</strong> for Python here. Other packages include:</p>
<ul>
<li>R: <strong>BayesianNetwork</strong> and <strong>gRain</strong></li>
<li>Python: <strong>PyMC3</strong>, <strong>bnlearn</strong> and <strong>PyBN</strong></li>
</ul>
<p>First load (or install and load) the relevant packages. We’ll need some additional packages to explore the data before model building.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bnlearn)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gRain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="discrete-bayesian-networks" class="level2">
<h2 class="anchored" data-anchor-id="discrete-bayesian-networks">Discrete Bayesian Networks</h2>
<p>We’ll start with an example of a discrete Bayesian Network. In these networks, all variables are multinomial (i.e.&nbsp;binary or multi-category). This facilitates the analysis as all probability distributions can be described as simple conditional probability tables (more on this below).</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Let’s now load the data. The dataset we’ll use represents information from a travel survey. This includes the following variables (listed with their categories):</p>
<ul>
<li>Age (<code>A</code>): adult/young/old</li>
<li>Size of employment region (<code>R</code>): big/small</li>
<li>Education (<code>E</code>): high/uni</li>
<li>Occupation (<code>O</code>): emp/self</li>
<li>Sex (<code>S</code>): F/M</li>
<li>Travel mode (<code>T</code>): car/train/other</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>travel <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"./data/survey.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(travel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     R    E   O S     T
1 adult   big high emp F   car
2 adult small  uni emp M   car
3 adult   big  uni emp F train
4 adult   big high emp M   car
5 adult   big high emp M   car
6 adult small high emp F train</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>travel <span class="ot">&lt;-</span> travel <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is_character, <span class="sc">~</span><span class="fu">as.factor</span>(.x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>travel <span class="op">=</span> pd.read_csv(<span class="st">"./data/survey.txt"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                      delimiter<span class="op">=</span><span class="st">' '</span>, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>travel.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A      R     E    O  S      T
0  adult    big  high  emp  F    car
1  adult  small   uni  emp  M    car
2  adult    big   uni  emp  F  train
3  adult    big  high  emp  M    car
4  adult    big  high  emp  M    car</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The nodes are assumed to connect following the DAG below. In this, there are the following paths:</p>
<ul>
<li>Path from age to education (younger people more likely to have higher ed level)</li>
<li>Path from age to education (women more likely to have higher ed level)</li>
<li>Path from education to occupation</li>
<li>Path from education to residence (size of city; high ed -&gt; bigger cities)</li>
<li>Path from occupation type to travel mode</li>
<li>Path from residence to travel mode</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example 1</h3>
<p>In this first example, we’ll build both the structure and parameters of the model using expert knowledge.</p>
<section id="structure-learning" class="level4">
<h4 class="anchored" data-anchor-id="structure-learning">Structure learning</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><strong>bnlearn</strong> has a couple of different ways to specify network structures. The one we’ll use here allows you to create both the nodes (variables) and the links (paths) in one go. The function is <code>model2network</code>. Each variable is specified in <code>[ ]</code>, together with any other variables that it depends on. So <code>[C|A:B]</code> indicates a node <code>C</code> which has paths coming in from nodes `<code>A</code> and <code>B</code>. (Note that the node names need to match the column headers of any data we want to use.) The following code specifies the DAG shown above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">model2network</span>(<span class="st">"[A][S][E|A:S][O|E][R|E][T|O:R]"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Random/Generated Bayesian network

  model:
   [A][S][E|A:S][O|E][R|E][T|O:R] 
  nodes:                                 6 
  arcs:                                  6 
    undirected arcs:                     0 
    directed arcs:                       6 
  average markov blanket size:           2.67 
  average neighbourhood size:            2.00 
  average branching factor:              1.00 

  generation algorithm:                  Empty </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">amat</span>(dag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  A E O R S T
A 0 1 0 0 0 0
E 0 0 1 1 0 0
O 0 0 0 0 0 1
R 0 0 0 0 0 1
S 0 1 0 0 0 0
T 0 0 0 0 0 0</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>In Python’s <strong>pgmpy</strong> package, the network is built by specifying all the paths as a set of origin/destination tuples. Note that the node names need to match the column headers of any data we want to use. The following code specifies the DAG shown above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.models <span class="im">import</span> BayesianNetwork</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>travel_model <span class="op">=</span> BayesianNetwork(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'A'</span>, <span class="st">'E'</span>),  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'S'</span>, <span class="st">'E'</span>), </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'E'</span>, <span class="st">'O'</span>), </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'E'</span>, <span class="st">'R'</span>), </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'O'</span>, <span class="st">'T'</span>), </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'R'</span>, <span class="st">'T'</span>)  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>travel_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;pgmpy.models.BayesianNetwork.BayesianNetwork object at 0x396fb8910&gt;</code></pre>
</div>
</div>
<p><strong>pgmpy</strong> doesn’t return the adjacency matrix directly, but you can access it through <strong>networkx</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.DiGraph(travel_model.edges())</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nx.to_numpy_array(G))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0. 1. 0. 0. 0. 0.]
 [0. 0. 1. 1. 0. 0.]
 [0. 0. 0. 0. 0. 1.]
 [0. 0. 0. 0. 0. 1.]
 [0. 1. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]]</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>In the network description, there are 6 paths described (all directed). The adjacency matrix shows these; each row is an origin node and each column a destination. A <code>1</code> represents a path from that origin to destination. We can visualize the structure as well:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><strong>bnlearn</strong> has a native plotting function, but usually a better plot can be obtained by using <strong>graphviz</strong> (you will probably need to install this separately).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(dag)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(dag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: Rgraphviz</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>viz <span class="op">=</span> travel_model.to_graphviz()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>viz.draw(<span class="st">'travel.png'</span>, prog<span class="op">=</span><span class="st">'neato'</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">'travel.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
</div>
</div>
</div>
</section>
<section id="parameter-learning" class="level4">
<h4 class="anchored" data-anchor-id="parameter-learning">Parameter learning</h4>
<p>In a discrete Bayesian network, the parameters are the conditional probabilities for each variable, and can be set using conditional probability tables (cpds). For an exogenous variable (one with no paths coming in), this simply represents the probability of each class. So if in our example, we expected 30% young respondents, 50% adult and 20% old, the cpd for age would be:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><code>young</code></th>
<th><code>adult</code></th>
<th><code>old</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.3</td>
<td>0.5</td>
<td>0.2</td>
</tr>
</tbody>
</table>
<p>For endogenous variables (one with at least one path coming in) this becomes more difficult, as we need to specify the pairwise probabilities for each category of the variable of interest conditioned on each category of the parent variable. For example, occupation (<code>O</code>) is dependent on the level of education (<code>E</code>), so we might assign the following probabilities: <code>emp</code> and <code>high</code>: 96%; <code>emp</code> and <code>uni</code>: 92%; <code>self</code> and <code>high</code>: 4%; <code>self</code> and <code>uni</code>: 8%. Note the probabilites for each level of the variable of interest (<code>O</code>) have to sum to 1 (or 100%). The cpd might look something like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><code>emp</code></th>
<th><code>self</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>high</code></td>
<td>0.96</td>
<td>0.92</td>
</tr>
<tr class="even">
<td><code>uni</code></td>
<td>0.04</td>
<td>0.08</td>
</tr>
</tbody>
</table>
<p>For variables with two incoming paths (<code>E</code> and <code>T</code>), this becomes even more complicated as we now need the conditional probability for each combination of categories (i.e.&nbsp;each of <code>E</code>, <code>A</code> and <code>S</code>). As you might imagine, this becomes non-trivial for large and complex networks, where learning from data provides an easier way forward.</p>
<p>Let’s now make the cpds. Generally, this requires the tables to be first defined then linked to the DAG created above.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>In R, we first defined the <em>levels</em>, the categories of each variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>A_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"young"</span>, <span class="st">"adult"</span>, <span class="st">"old"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>S_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>E_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"uni"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>O_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"emp"</span>, <span class="st">"self"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>R_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"small"</span>, <span class="st">"big"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>T_lv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"car"</span>, <span class="st">"train"</span>, <span class="st">"other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we define the cpds. We’ll start with the two exogenous variables (<code>A</code> and <code>S</code>). Each of these is simply a 1D vector of probabilities that should sum to 1. The vector for <code>A</code> needs three entries as there are three levels. Note that the <em>dimnames</em> are set using the levels created above (this allows the model to find the correct probability).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ----cpds-A-S-----------------------------------------------------------------</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>A_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.30</span>, <span class="fl">0.50</span>, <span class="fl">0.20</span>), <span class="at">dim =</span> <span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">A =</span> A_lv))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>A_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A
young adult   old 
  0.3   0.5   0.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>S_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.60</span>, <span class="fl">0.40</span>), <span class="at">dim =</span> <span class="dv">2</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">S =</span> S_lv))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>S_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>S
  M   F 
0.6 0.4 </code></pre>
</div>
</div>
<p>Next we’ll do the variables with one incoming path (<code>O</code> and <code>R</code>). These need a 2D array of probabilities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ----cpds-O-R-----------------------------------------------------------------</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>O_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.96</span>, <span class="fl">0.04</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.92</span>, <span class="fl">0.08</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">O =</span> O_lv, <span class="at">E =</span> E_lv))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>O_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      E
O      high  uni
  emp  0.96 0.92
  self 0.04 0.08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>R_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.20</span>, <span class="fl">0.80</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">R =</span> R_lv, <span class="at">E =</span> E_lv))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>R_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       E
R       high uni
  small 0.25 0.2
  big   0.75 0.8</code></pre>
</div>
</div>
<p>And finally, the two variables with 2 incoming paths. These need a 3D array (one dimension per variable). Note that the dimension definitions start to become more important here. For <code>E</code>, we have <code>A</code> and <code>S</code>, which have 3 and 2 levels respectively, and <code>E</code> has 2. The order we have chose here (<code>E</code>, <code>A</code>, <code>S</code>) needs an array with the following dimensions <code>[2,3,2]</code>.</p>
<p>For the second (<code>T</code>, 3 levels), we have <code>O</code> and <code>R</code>, which both have 2 levels. The array dimension are then <code>[3,2,2]</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ----cpds-E-T-----------------------------------------------------------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>E_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>, <span class="fl">0.72</span>, <span class="fl">0.28</span>, <span class="fl">0.88</span>, <span class="fl">0.12</span>, <span class="fl">0.64</span>, <span class="fl">0.36</span>, <span class="fl">0.70</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.30</span>, <span class="fl">0.90</span>, <span class="fl">0.10</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">E =</span> E_lv, <span class="at">A =</span> A_lv, <span class="at">S =</span> S_lv))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>E_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , S = M

      A
E      young adult  old
  high  0.75  0.72 0.88
  uni   0.25  0.28 0.12

, , S = F

      A
E      young adult old
  high  0.64   0.7 0.9
  uni   0.36   0.3 0.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>T_cpd <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.48</span>, <span class="fl">0.42</span>, <span class="fl">0.10</span>, <span class="fl">0.56</span>, <span class="fl">0.36</span>, <span class="fl">0.08</span>, <span class="fl">0.58</span>, <span class="fl">0.24</span>, <span class="fl">0.18</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.70</span>, <span class="fl">0.21</span>, <span class="fl">0.09</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">T =</span> T_lv, <span class="at">O =</span> O_lv, <span class="at">R =</span> R_lv))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>T_cpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , R = small

       O
T        emp self
  car   0.48 0.56
  train 0.42 0.36
  other 0.10 0.08

, , R = big

       O
T        emp self
  car   0.58 0.70
  train 0.24 0.21
  other 0.18 0.09</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>In Python, we can create these tables using <strong>pgmpy</strong>’s function <code>TabularCPD</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.factors.discrete <span class="im">import</span> TabularCPD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll start with the two exogenous variables (<code>A</code> and <code>S</code>). Each of these is simply a 1D vector of probabilities that should sum to 1. The vector for <code>A</code> needs three entries as there are three levels. Note that the <em>state_names</em> are set using the levels created above (this allows the model to find the correct probability).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cpd_A <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'A'</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                    variable_card<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                    values<span class="op">=</span>[[<span class="fl">0.3</span>], [<span class="fl">0.5</span>], [<span class="fl">0.2</span>]],</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                    state_names<span class="op">=</span>{<span class="st">'A'</span>: [<span class="st">'young'</span>, <span class="st">'adult'</span>, <span class="st">'old'</span>]})</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+-----+
| A(young) | 0.3 |
+----------+-----+
| A(adult) | 0.5 |
+----------+-----+
| A(old)   | 0.2 |
+----------+-----+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sex</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cpd_S <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'S'</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                    variable_card<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                    values<span class="op">=</span>[[<span class="fl">0.6</span>], [<span class="fl">0.4</span>]],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                    state_names<span class="op">=</span>{<span class="st">'S'</span>: [<span class="st">'M'</span>, <span class="st">'F'</span>]})</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+-----+
| S(M) | 0.6 |
+------+-----+
| S(F) | 0.4 |
+------+-----+</code></pre>
</div>
</div>
<p>Next we’ll do the variables with one incoming path (<code>O</code> and <code>R</code>). These need a 2D array of probabilities (the columns represent the probability for one level of the destination node (e.g.&nbsp;<code>O</code>) and so should sum to 1. We specify the variables that are used as input as <code>evidence</code>, and need to specify the number of levels of these (<code>evidence_card</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Occupation</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cpd_O <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'O'</span>, variable_card<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                   values<span class="op">=</span>[[<span class="fl">0.96</span>, <span class="fl">0.92</span>],</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.04</span>, <span class="fl">0.08</span>]],</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                           evidence<span class="op">=</span>[<span class="st">'E'</span>], evidence_card<span class="op">=</span>[<span class="dv">2</span>],</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                           state_names<span class="op">=</span>{<span class="st">'O'</span>: [<span class="st">'emp'</span>, <span class="st">'self'</span>],</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'E'</span>: [<span class="st">'high'</span>, <span class="st">'uni'</span>]})</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_O)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+---------+--------+
| E       | E(high) | E(uni) |
+---------+---------+--------+
| O(emp)  | 0.96    | 0.92   |
+---------+---------+--------+
| O(self) | 0.04    | 0.08   |
+---------+---------+--------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sex</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Residence</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>cpd_R <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'R'</span>, variable_card<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                   values<span class="op">=</span>[[<span class="fl">0.25</span>, <span class="fl">0.20</span>],</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.75</span>, <span class="fl">0.80</span>]],</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                           evidence<span class="op">=</span>[<span class="st">'E'</span>], evidence_card<span class="op">=</span>[<span class="dv">2</span>],</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                           state_names<span class="op">=</span>{<span class="st">'R'</span>: [<span class="st">'small'</span>, <span class="st">'big'</span>],</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'E'</span>: [<span class="st">'high'</span>, <span class="st">'uni'</span>]})</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+---------+--------+
| E        | E(high) | E(uni) |
+----------+---------+--------+
| R(small) | 0.25    | 0.2    |
+----------+---------+--------+
| R(big)   | 0.75    | 0.8    |
+----------+---------+--------+</code></pre>
</div>
</div>
<p>And finally, the two variables with 2 incoming paths. Again, we use a 2D array to represent these, where each row represents one level of the destination node (e.g.&nbsp;<code>E</code>) and each column represents one pair of levels of the input nodes (e.g.&nbsp;<code>A</code> and <code>S</code>). We now have two variables for <code>evidence</code>, and we need to update the <code>evidence_card</code> to reflect this (<code>A</code> has 3 levels and <code>S</code> has 2).</p>
<p>For the second (<code>T</code>, 3 levels), we have <code>O</code> and <code>R</code> as <code>evidence</code>, which both have 2 levels. The <code>evidence_card</code> dimension are then <code>[2,2]</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Education</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cpd_E <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'E'</span>, variable_card<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                   values<span class="op">=</span>[[<span class="fl">0.75</span>, <span class="fl">0.64</span>, <span class="fl">0.72</span>, <span class="fl">0.70</span>, <span class="fl">0.88</span>, <span class="fl">0.90</span>],</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.25</span>, <span class="fl">0.36</span>, <span class="fl">0.28</span>, <span class="fl">0.30</span>, <span class="fl">0.12</span>, <span class="fl">0.10</span>]],</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                           evidence<span class="op">=</span>[<span class="st">'A'</span>, <span class="st">'S'</span>],</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                           evidence_card<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                           state_names<span class="op">=</span>{<span class="st">'E'</span>: [<span class="st">'high'</span>, <span class="st">'uni'</span>],</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'A'</span>: [<span class="st">'young'</span>, <span class="st">'adult'</span>, <span class="st">'old'</span>],</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'S'</span>: [<span class="st">'M'</span>, <span class="st">'F'</span>]})</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_E)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+----------+----------+----------+----------+--------+--------+
| A       | A(young) | A(young) | A(adult) | A(adult) | A(old) | A(old) |
+---------+----------+----------+----------+----------+--------+--------+
| S       | S(M)     | S(F)     | S(M)     | S(F)     | S(M)   | S(F)   |
+---------+----------+----------+----------+----------+--------+--------+
| E(high) | 0.75     | 0.64     | 0.72     | 0.7      | 0.88   | 0.9    |
+---------+----------+----------+----------+----------+--------+--------+
| E(uni)  | 0.25     | 0.36     | 0.28     | 0.3      | 0.12   | 0.1    |
+---------+----------+----------+----------+----------+--------+--------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Travel</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>cpd_T <span class="op">=</span> TabularCPD(variable<span class="op">=</span><span class="st">'T'</span>, variable_card<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                   values<span class="op">=</span>[[<span class="fl">0.48</span>, <span class="fl">0.58</span>, <span class="fl">0.56</span>, <span class="fl">0.70</span>],</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.42</span>, <span class="fl">0.24</span>, <span class="fl">0.36</span>, <span class="fl">0.21</span>],</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                           [<span class="fl">0.10</span>, <span class="fl">0.18</span>, <span class="fl">0.08</span>, <span class="fl">0.09</span>]],</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                           evidence<span class="op">=</span>[<span class="st">'O'</span>, <span class="st">'R'</span>],</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                           evidence_card<span class="op">=</span>[<span class="dv">2</span>, <span class="dv">2</span>],</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                           state_names<span class="op">=</span>{<span class="st">'T'</span>: [<span class="st">'car'</span>, <span class="st">'train'</span>, <span class="st">'other'</span>],</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'O'</span>: [<span class="st">'emp'</span>, <span class="st">'self'</span>],</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">'R'</span>: [<span class="st">'small'</span>, <span class="st">'big'</span>]})</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cpd_T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+--------+----------+---------+
| O        | O(emp)   | O(emp) | O(self)  | O(self) |
+----------+----------+--------+----------+---------+
| R        | R(small) | R(big) | R(small) | R(big)  |
+----------+----------+--------+----------+---------+
| T(car)   | 0.48     | 0.58   | 0.56     | 0.7     |
+----------+----------+--------+----------+---------+
| T(train) | 0.42     | 0.24   | 0.36     | 0.21    |
+----------+----------+--------+----------+---------+
| T(other) | 0.1      | 0.18   | 0.08     | 0.09    |
+----------+----------+--------+----------+---------+</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>With these set, we can now link them to the network.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cpd <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">A =</span> A_cpd, <span class="at">S =</span> S_cpd, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">E =</span> E_cpd, <span class="at">O =</span> O_cpd, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">R =</span> R_cpd, <span class="at">T =</span> T_cpd)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>bn <span class="ot">&lt;-</span> <span class="fu">custom.fit</span>(dag, cpd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can print any of these from the fitted network as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>bn<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Parameters of node T (multinomial distribution)

Conditional probability table:
 
, , R = small

       O
T        emp self
  car   0.48 0.56
  train 0.42 0.36
  other 0.10 0.08

, , R = big

       O
T        emp self
  car   0.58 0.70
  train 0.24 0.21
  other 0.18 0.09</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>travel_model.add_cpds(cpd_A, cpd_S, cpd_E, cpd_O, cpd_R, cpd_T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>You can print any of these from the fitted network as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(travel_model.get_cpds(<span class="st">"T"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+--------+----------+---------+
| O        | O(emp)   | O(emp) | O(self)  | O(self) |
+----------+----------+--------+----------+---------+
| R        | R(small) | R(big) | R(small) | R(big)  |
+----------+----------+--------+----------+---------+
| T(car)   | 0.48     | 0.58   | 0.56     | 0.7     |
+----------+----------+--------+----------+---------+
| T(train) | 0.42     | 0.24   | 0.36     | 0.21    |
+----------+----------+--------+----------+---------+
| T(other) | 0.1      | 0.18   | 0.08     | 0.09    |
+----------+----------+--------+----------+---------+</code></pre>
</div>
</div>
</section>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example 2</h3>
<p>For the second example, we’ll use the network structure that we created from expert knowledge in the first example, but we’ll learn the parameters using the travel survey dataset:</p>
<section id="structure-learning-1" class="level4">
<h4 class="anchored" data-anchor-id="structure-learning-1">Structure learning</h4>
<p>We’ll recreate the empty DAG first (note that we could simply update the parameters from the original if we wanted).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">model2network</span>(<span class="st">"[A][S][E|A:S][O|E][R|E][T|O:R]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>travel_model <span class="op">=</span> BayesianNetwork(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'A'</span>, <span class="st">'E'</span>),  </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'S'</span>, <span class="st">'E'</span>), </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'E'</span>, <span class="st">'O'</span>), </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'E'</span>, <span class="st">'R'</span>), </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'O'</span>, <span class="st">'T'</span>), </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'R'</span>, <span class="st">'T'</span>)  </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="parameter-learning-1" class="level4">
<h4 class="anchored" data-anchor-id="parameter-learning-1">Parameter learning</h4>
<p>Let’s now learn the parameters. We’ll use a Maximum Likelihood estimator, but there are other options (e.g.&nbsp;Expectation Maximization):</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>bn.mle <span class="ot">&lt;-</span> <span class="fu">bn.fit</span>(dag, <span class="at">data =</span> travel, <span class="at">method =</span> <span class="st">"mle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.estimators <span class="im">import</span> MaximumLikelihoodEstimator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>travel_model.fit(travel, MaximumLikelihoodEstimator)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>You can check that the values match those in the file</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>In R, the combination of <code>table</code> and <code>prop.table</code> can be used to show probabilities. Here’s the values from the original dataframe for <code>A</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(travel[, <span class="fu">c</span>(<span class="st">"A"</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
adult   old young 
0.472 0.208 0.320 </code></pre>
</div>
</div>
<p>And here’s the estimates from the model fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Parameters of node A (multinomial distribution)

Conditional probability table:
 adult   old young 
0.472 0.208 0.320 </code></pre>
</div>
</div>
<p>Similarly, here are the original probabilities for <code>O</code>, conditioned on <code>E</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(travel[, <span class="fu">c</span>(<span class="st">"O"</span>, <span class="st">"E"</span>)]), <span class="at">margin =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      E
O            high        uni
  emp  0.98082192 0.92592593
  self 0.01917808 0.07407407</code></pre>
</div>
</div>
<p>And here are the model estimates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>bn.mle<span class="sc">$</span>O</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Parameters of node O (multinomial distribution)

Conditional probability table:
 
      E
O            high        uni
  emp  0.98082192 0.92592593
  self 0.01917808 0.07407407</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>In Python, we can use pandas’ <code>value_counts()</code> function to get the original probabilities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>travel[<span class="st">'A'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A
adult    0.472
young    0.320
old      0.208
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<p>And here’s the estimates from the model fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(travel_model.get_cpds(<span class="st">'A'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+-------+
| A(adult) | 0.472 |
+----------+-------+
| A(old)   | 0.208 |
+----------+-------+
| A(young) | 0.32  |
+----------+-------+</code></pre>
</div>
</div>
<p>Similarly, here are the original probabilities for <code>O</code>, conditioned on <code>E</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(travel[<span class="st">'O'</span>], travel[<span class="st">'E'</span>], normalize<span class="op">=</span><span class="st">'columns'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>E         high       uni
O                       
emp   0.980822  0.925926
self  0.019178  0.074074</code></pre>
</div>
</div>
<p>And here are the model estimates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(travel_model.get_cpds(<span class="st">'O'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+----------------------+---------------------+
| E       | E(high)              | E(uni)              |
+---------+----------------------+---------------------+
| O(emp)  | 0.9808219178082191   | 0.9259259259259259  |
+---------+----------------------+---------------------+
| O(self) | 0.019178082191780823 | 0.07407407407407407 |
+---------+----------------------+---------------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">Example 3</h3>
<p>For the third example, we’ll look at how to learn the network structure from the dataset.</p>
<section id="structure-learning-2" class="level4">
<h4 class="anchored" data-anchor-id="structure-learning-2">Structure learning</h4>
<p>There are a large number of structure learning algorithms. Here, we’ll just demonstrate the HillClimb (a form of greedy search) and the Peters-Clark algorithm. If you are interested in using these with your own data, I’d strongly recommend reading the documents for other options.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<ul>
<li>Hill Climb</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>travel_hc <span class="ot">&lt;-</span> <span class="fu">hc</span>(travel)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modelstring</span>(travel_hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[R][E|R][T|R][A|E][O|E][S|E]"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(travel_hc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Peters-Clark</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>travel_pc <span class="ot">&lt;-</span> <span class="fu">pc.stable</span>(travel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in vstruct.apply(arcs = arcs, vs = vs, nodes = nodes, debug = debug):
vstructure E -&gt; R &lt;- T is not applicable, because one or both arcs are oriented
in the opposite direction.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelstring(travel_pc)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(travel_pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.estimators <span class="im">import</span> PC, HillClimbSearch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Hill Climb</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> HillClimbSearch(data<span class="op">=</span>travel)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>travel_hc <span class="op">=</span> est.estimate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0%|          | 0/1000000 [00:00&lt;?, ?it/s]
  0%|          | 7/1000000 [00:00&lt;1:37:36, 170.75it/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>viz <span class="op">=</span> travel_hc.to_graphviz()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>viz.draw(<span class="st">'travel_hc.png'</span>, prog<span class="op">=</span><span class="st">'neato'</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">'travel_hc.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
<ul>
<li>Peters-Clark</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>est <span class="op">=</span> PC(data<span class="op">=</span>travel)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>travel_pc <span class="op">=</span> est.estimate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0%|          | 0/5 [00:00&lt;?, ?it/s]
Working for n conditional variables: 0:   0%|          | 0/5 [00:00&lt;?, ?it/s]
Working for n conditional variables: 1:  20%|##        | 1/5 [00:00&lt;00:00, 84.56it/s]
Working for n conditional variables: 2:  40%|####      | 2/5 [00:00&lt;00:00, 80.37it/s]
Working for n conditional variables: 2:  40%|####      | 2/5 [00:00&lt;00:00, 80.20it/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>viz <span class="op">=</span> travel_pc.to_graphviz()</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>viz.draw(<span class="st">'travel_pc.png'</span>, prog<span class="op">=</span><span class="st">'neato'</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">'travel_pc.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
</div>
</div>
</div>
<p>The learned structure is quite a way from our original DAG, but provides a first estimate of the structure that can be subsequently modified.</p>
</section>
</section>
<section id="inference-with-bayesian-networks" class="level3">
<h3 class="anchored" data-anchor-id="inference-with-bayesian-networks">Inference with Bayesian networks</h3>
<p>Once the model is set up (i.e.&nbsp;structure and parameter learning has been run), we can use it to ask questions. This can be done with exact or approximate inference. For this model, which is relatively simple, we’ll use the exact approach.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p>In R, the model can be queried by first converting it to a junction tree (this allows quick queries across the graph structure):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>junction <span class="ot">&lt;-</span> <span class="fu">compile</span>(<span class="fu">as.grain</span>(bn.mle))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can query it using <code>querygrain</code>. For example, to know the probabilities of different travel modes, we simply ask it to return a single node (this is <span class="math inline">\(P(T)\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(junction, <span class="at">nodes =</span> <span class="st">"T"</span>)<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>T
      car     other     train 
0.5798627 0.1696901 0.2504472 </code></pre>
</div>
</div>
<p>More usefully, we can query the model with <em>evidence</em>. This simply means setting some of the nodes to fixed values. To do this, we first adjust the junction with the evidence, then query it. So to see the travel probabilities for female participants (this is <span class="math inline">\(P(T|S)\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>jquery <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junction, <span class="at">nodes =</span> <span class="st">"S"</span>, <span class="at">states =</span> <span class="st">"F"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jquery, <span class="at">nodes =</span> <span class="st">"T"</span>)<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>T
      car     other     train 
0.5808236 0.1710347 0.2481417 </code></pre>
</div>
</div>
<p>There’s no great difference in the results, suggesting that there is little difference between female and male participants in travel mode choice.</p>
<p>Another question is whether living in small or big towns affects travel choice (<span class="math inline">\(P(T|R)\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>jquery <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junction, <span class="at">nodes =</span> <span class="st">"R"</span>, <span class="at">states =</span> <span class="st">"small"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jquery, <span class="at">nodes =</span> <span class="st">"T"</span>)<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>T
       car      other      train 
0.55255599 0.08165301 0.36579100 </code></pre>
</div>
</div>
<p>You can also combine multiple lines of evidence in the query. We can, for example, query the travel models for older participants in big towns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>jquery <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junction, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"A"</span>), </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">states =</span> <span class="fu">c</span>(<span class="st">"big"</span>, <span class="st">"old"</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jquery, <span class="at">nodes =</span> <span class="st">"T"</span>)<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>T
      car     other     train 
0.5876406 0.1982070 0.2141524 </code></pre>
</div>
</div>
<p>You can also query multiple nodes. For example, to see the probability relating to car drivers (<code>S</code> and <code>E</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>jquery <span class="ot">&lt;-</span> <span class="fu">setEvidence</span>(junction, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"T"</span>), </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">states =</span> <span class="fu">c</span>(<span class="st">"car"</span>))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jquery, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"E"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$E
E
     high       uni 
0.7263969 0.2736031 

$S
S
        F         M 
0.4026662 0.5973338 </code></pre>
</div>
</div>
<p>This returns the marginal probability (i.e.&nbsp;the independent probabilities). You can also get the conditional probabilities as follows. In this case, this shows the probability of a car driver being male or female <em>conditioned</em> on their education level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">querygrain</span>(jquery, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"E"</span>),</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"conditional"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   E
S        high      uni
  F 0.3577227 0.521988
  M 0.6422773 0.478012</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p>In Python, the model can be queried using a couple of different approaches. Here, we’ll use variable elimination, a simple method where and node that is conditionally independent is removed from the query before running it. First we need to instantiate an inference model using <code>VariableElimination</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.inference <span class="im">import</span> VariableElimination</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>travel_infer <span class="op">=</span> VariableElimination(travel_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can query it using <code>query</code>. For example, to know the probabilities of different travel modes, we simply ask it to return a single node (this is <span class="math inline">\(P(T)\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"T"</span>])</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+
| T        |   phi(T) |
+==========+==========+
| T(car)   |   0.5799 |
+----------+----------+
| T(other) |   0.1697 |
+----------+----------+
| T(train) |   0.2504 |
+----------+----------+</code></pre>
</div>
</div>
<p>More usefully, we can query the model with <em>evidence</em>. This simply means setting some of the nodes to fixed values. To do this, we first adjust the junction with the evidence, then query it. So to see the travel probabilities for female participants (this is <span class="math inline">\(P(T|S)\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"T"</span>], evidence<span class="op">=</span>{<span class="st">"S"</span>: <span class="st">"F"</span>})</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+
| T        |   phi(T) |
+==========+==========+
| T(car)   |   0.5808 |
+----------+----------+
| T(other) |   0.1710 |
+----------+----------+
| T(train) |   0.2481 |
+----------+----------+</code></pre>
</div>
</div>
<p>There’s no great difference in the results, suggesting that there is little difference between female and male participants in travel mode choice.</p>
<p>Another question is whether living in small or big towns affects travel choice (<span class="math inline">\(P(T|R)\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"T"</span>], evidence<span class="op">=</span>{<span class="st">"R"</span>: <span class="st">"small"</span>})</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+
| T        |   phi(T) |
+==========+==========+
| T(car)   |   0.5526 |
+----------+----------+
| T(other) |   0.0817 |
+----------+----------+
| T(train) |   0.3658 |
+----------+----------+</code></pre>
</div>
</div>
<p>You can also combine multiple lines of evidence in the query. We can, for example, query the travel models for older participants in big towns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"T"</span>], </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>                       evidence<span class="op">=</span>{<span class="st">"R"</span>: <span class="st">"big"</span>, <span class="st">"A"</span>: <span class="st">"old"</span>})</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+----------+
| T        |   phi(T) |
+==========+==========+
| T(car)   |   0.5876 |
+----------+----------+
| T(other) |   0.1982 |
+----------+----------+
| T(train) |   0.2142 |
+----------+----------+</code></pre>
</div>
</div>
<p>You can also query multiple nodes. For example, to see the probability relating to car drivers (<code>S</code> and <code>E</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"S"</span>, <span class="st">"E"</span>], </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>                       evidence<span class="op">=</span>{<span class="st">"T"</span>: <span class="st">"car"</span>},</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                       joint<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q[<span class="st">'S'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+----------+
| S    |   phi(S) |
+======+==========+
| S(F) |   0.4027 |
+------+----------+
| S(M) |   0.5973 |
+------+----------+</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q[<span class="st">'E'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+----------+
| E       |   phi(E) |
+=========+==========+
| E(high) |   0.7264 |
+---------+----------+
| E(uni)  |   0.2736 |
+---------+----------+</code></pre>
</div>
</div>
<p>This returns the marginal probability (i.e.&nbsp;the independent probabilities). You can also get the conditional probabilities as follows. In this case, this shows the probability of a car driver being male or female <em>conditioned</em> on their education level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> travel_infer.query(variables<span class="op">=</span>[<span class="st">"S"</span>, <span class="st">"E"</span>], </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>                       evidence<span class="op">=</span>{<span class="st">"T"</span>: <span class="st">"car"</span>},</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                       joint<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+---------+------------+
| S    | E       |   phi(S,E) |
+======+=========+============+
| S(F) | E(high) |     0.2598 |
+------+---------+------------+
| S(F) | E(uni)  |     0.1428 |
+------+---------+------------+
| S(M) | E(high) |     0.4665 |
+------+---------+------------+
| S(M) | E(uni)  |     0.1308 |
+------+---------+------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="gaussian-bayesian-networks" class="level2">
<h2 class="anchored" data-anchor-id="gaussian-bayesian-networks">Gaussian Bayesian networks</h2>
<p>We’ll next look at working with continuous data in a Gaussian Bayesian network. Here’s we’ll use the published DAG to create our network, but learn the parameters from the data. Start by loading this:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/keeley.csv"</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  distance elev  abiotic age   hetero firesev     cover rich
1 53.40900 1225 60.67103  40 0.757065    3.50 1.0387974   51
2 37.03745   60 40.94291  25 0.491340    4.05 0.4775924   31
3 53.69565  200 50.98805  15 0.844485    2.60 0.9489357   71
4 53.69565  200 61.15633  15 0.690847    2.90 1.1949002   64
5 51.95985  970 46.66807  23 0.545628    4.30 1.2981890   68
6 51.95985  970 39.82357  24 0.652895    4.00 1.1734866   34</code></pre>
</div>
</div>
<p>We’ll drop the <code>elev</code> value as we won’t be using it, and convert all the values to numeric (they are read in as integers)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="ot">&lt;-</span> keeley <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>elev) <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is_integer, <span class="sc">~</span><span class="fu">as.numeric</span>(.x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>keeley <span class="op">=</span> pd.read_csv(<span class="st">"./data/keeley.csv"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>keeley.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   distance  elev    abiotic  age    hetero  firesev     cover  rich
0  53.40900  1225  60.671026   40  0.757065     3.50  1.038797    51
1  37.03745    60  40.942914   25  0.491340     4.05  0.477592    31
2  53.69565   200  50.988054   15  0.844485     2.60  0.948936    71
3  53.69565   200  61.156331   15  0.690847     2.90  1.194900    64
4  51.95985   970  46.668071   23  0.545628     4.30  1.298189    68</code></pre>
</div>
</div>
<p>We’ll drop the <code>elev</code> value as we won’t be using it</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>keeley.drop(<span class="st">'elev'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="structure-learning-3" class="level3">
<h3 class="anchored" data-anchor-id="structure-learning-3">Structure learning</h3>
<p>We’ll build the network manually again.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<p>In R, we’ll do this in two steps to make this a bit more interpretable. We first create an empty graph, where we specify the nodes (note that the names need to correspond to the column names in the data frame for parameter learning)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty.graph</span>(<span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"distance"</span>, <span class="st">"abiotic"</span>, <span class="st">"hetero"</span>, <span class="st">"age"</span>,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"firesev"</span>, <span class="st">"cover"</span>, <span class="st">"rich"</span>))</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>dag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Random/Generated Bayesian network

  model:
   [distance][abiotic][hetero][age][firesev][cover][rich] 
  nodes:                                 7 
  arcs:                                  0 
    undirected arcs:                     0 
    directed arcs:                       0 
  average markov blanket size:           0.00 
  average neighbourhood size:            0.00 
  average branching factor:              0.00 

  generation algorithm:                  Empty </code></pre>
</div>
</div>
<p>We can now start adding paths one at a time using <code>set.arc</code>. This takes as arguments: the original DAG, and the origin and destination nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"distance"</span>, <span class="at">to =</span> <span class="st">"abiotic"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"distance"</span>, <span class="at">to =</span> <span class="st">"hetero"</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"distance"</span>, <span class="at">to =</span> <span class="st">"age"</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"age"</span>, <span class="at">to =</span> <span class="st">"firesev"</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"firesev"</span>, <span class="at">to =</span> <span class="st">"cover"</span>)</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"cover"</span>, <span class="at">to =</span> <span class="st">"rich"</span>)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"abiotic"</span>, <span class="at">to =</span> <span class="st">"rich"</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">set.arc</span>(dag, <span class="at">from =</span> <span class="st">"hetero"</span>, <span class="at">to =</span> <span class="st">"rich"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graphviz.plot</span>(dag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pgmpy.models <span class="im">import</span> LinearGaussianBayesianNetwork</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>keeley_model <span class="op">=</span> LinearGaussianBayesianNetwork(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'abiotic'</span>),  </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'hetero'</span>), </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'hetero'</span>), </span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'age'</span>, <span class="st">'firesev'</span>), </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'firesev'</span>, <span class="st">'cover'</span>), </span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cover'</span>, <span class="st">'rich'</span>), </span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'abiotic'</span>, <span class="st">'rich'</span>), </span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'hetero'</span>, <span class="st">'rich'</span>) </span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>keeley_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;pgmpy.models.LinearGaussianBayesianNetwork.LinearGaussianBayesianNetwork object at 0x399ad60b0&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>viz <span class="op">=</span> keeley_model.to_graphviz()</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>viz.draw(<span class="st">'keeley.png'</span>, prog<span class="op">=</span><span class="st">'dot'</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">'keeley.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
</div>
</div>
</div>
</section>
<section id="parameter-learning-2" class="level3">
<h3 class="anchored" data-anchor-id="parameter-learning-2">Parameter learning</h3>
<p>Now we can learn the network parameters from the <code>keeley</code> dataframe:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>keeley_bn <span class="ot">&lt;-</span> <span class="fu">bn.fit</span>(dag, <span class="at">data =</span> keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>keeley_model.fit(keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Unlike the discrete network above, these networks assume that all variables are Gaussian, so can be estimated as a mean and variance. For exogenous variables, we only have these parameters:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>keeley_bn<span class="sc">$</span>distance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Parameters of node distance (Gaussian distribution)

Conditional density: distance
Coefficients:
(Intercept)  
   49.23458  
Standard deviation of the residuals: 8.82948 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(distance <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = distance ~ 1, data = keeley)

Coefficients:
(Intercept)  
      49.23  </code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(keeley_model.get_cpds(<span class="st">'distance'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P(distance) = N(49.235; 77.96)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'distance ~ 1'</span>, data<span class="op">=</span>keeley)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>fit_D <span class="op">=</span> mod.fit()</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fit_D.params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept    49.234583
dtype: float64</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>For any endogenous variable, the mean is conditioned on the parent nodes or variables. This simply equates to a linear model of the mean based on the parents. For example, the richness variable (<code>rich</code>) is conditioned on <code>abiotic</code>, <code>hetero</code> and <code>cover</code> (see paths above) giving:</p>
<p><span class="math display">\[
\mbox{rich} = \beta_0 + \beta_a \mbox{abiotic} + \beta_h \mbox{hetero}+ \beta_c \mbox{cover} + e; e \sim N(0, \sigma^2)
\]</span> To check this compare the results of the network model:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>keeley_bn<span class="sc">$</span>rich</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Parameters of node rich (Gaussian distribution)

Conditional density: rich | abiotic + hetero + cover
Coefficients:
(Intercept)      abiotic       hetero        cover  
-34.0773160    0.6847365   55.3686362   17.0137736  
Standard deviation of the residuals: 11.0076 </code></pre>
</div>
</div>
<p>With a simple linear model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(rich <span class="sc">~</span> abiotic <span class="sc">+</span> hetero <span class="sc">+</span> cover, <span class="at">data =</span> keeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rich ~ abiotic + hetero + cover, data = keeley)

Coefficients:
(Intercept)      abiotic       hetero        cover  
   -34.0773       0.6847      55.3686      17.0138  </code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(keeley_model.get_cpds(<span class="st">'rich'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>P(rich | cover, abiotic, hetero) = N(17.014*cover + 0.685*abiotic + 55.369*hetero + -34.077; 117.083)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'rich ~ abiotic + hetero + cover'</span>, data<span class="op">=</span>keeley)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>fit_D <span class="op">=</span> mod.fit()</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fit_D.params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept   -34.077316
abiotic       0.684736
hetero       55.368636
cover        17.013774
dtype: float64</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">Inference</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p>As this network is a little more complex, we’ll use approximate inference methods. These are based on random samples from the probability distributions underlying the model, and so your results may differ a little from those shown here.</p>
<p>As a first example, we’ll create some random samples of richness from the model, but with conditions: age of the vegetation is 60 and abiotic factors are 50:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">=</span> <span class="fu">cpdist</span>(keeley_bn, <span class="at">nodes =</span> <span class="st">"rich"</span>,</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">evidence =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">60</span>, <span class="at">abiotic =</span> <span class="dv">50</span>), </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"lw"</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rich
1 23.57638
2 40.00067
3 70.40909
4 53.42875
5 48.34768
6 40.16778</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> rich)) <span class="sc">+</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="GEOG6960_Week10_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As before, you can both query multiple nodes and use multiple conditions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">cpdist</span>(keeley_bn, </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">"rich"</span>, <span class="st">"firesev"</span>, <span class="st">"cover"</span>), </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">evidence =</span> (age <span class="sc">&gt;</span> <span class="dv">60</span> <span class="sc">&amp;</span> abiotic <span class="sc">&gt;</span> <span class="dv">50</span>))</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rich  firesev      cover
1 41.91827 9.334461 0.28685751
2 43.42748 6.821799 0.74889283
3 54.91049 5.857335 0.55463330
4 17.73995 8.456082 0.01939383
5 69.43777 4.054849 0.45703171
6 44.89904 6.749153 0.43393182</code></pre>
</div>
</div>
<p>And you can also query probabilities. For example, to find the probability that fire severity is above 6 for a location where the vegetation is 60 years old, abiotic factors are 30 and cover is equal to 0.5:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cpquery</span>(keeley_bn, <span class="at">event =</span> (firesev <span class="sc">&gt;</span> <span class="dv">6</span>),</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">evidence =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="dv">60</span>, <span class="at">abiotic =</span> <span class="dv">30</span>, <span class="at">cover =</span> <span class="fl">0.5</span>),</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">"lw"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7061464</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p>Currently, the <strong>pgmpy</strong> does not run inference on Linear Gaussian networks. So instead, we’ll use a second package to do this (<strong>lgnpy</strong>). You’ll need to install this (<code>pip install lgnpy</code>). You may also need to fix an error in one of the files. Find the file <code>LinearGaussian.py</code> in the <strong>lgnpy</strong> library, go to line 106, and replace <code>pd.np.nan</code> with <code>np.nan</code>. Now let’s load it and build the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lgnpy <span class="im">import</span> LinearGaussian</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LinearGaussian()</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>lg.set_edges_from([</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'abiotic'</span>),  </span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'hetero'</span>), </span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'distance'</span>, <span class="st">'age'</span>), </span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'age'</span>, <span class="st">'firesev'</span>), </span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'firesev'</span>, <span class="st">'cover'</span>), </span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cover'</span>, <span class="st">'rich'</span>), </span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'abiotic'</span>, <span class="st">'rich'</span>), </span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'hetero'</span>, <span class="st">'rich'</span>) </span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, estimate the model parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>lg.set_data(keeley)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>lg.network_summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Node     Mean      Std                   Parents                Children
0   abiotic  49.2390   7.6791                [distance]                  [rich]
1       age  25.5667  12.5663                [distance]               [firesev]
2     cover   0.6912   0.3172                 [firesev]                  [rich]
3  distance  49.2346   8.8295                        []  [abiotic, hetero, age]
4   firesev   4.5650   1.6523                     [age]                 [cover]
5    hetero   0.6833   0.1148                [distance]                  [rich]
6      rich  49.2333  15.1057  [cover, abiotic, hetero]                      []</code></pre>
</div>
</div>
<p>Now we can run inference on the model. First run the inference with no constraints. This will print the expected mean and variance for all variables in the model. Note that the <code>Mean</code> and <code>Mean_inferred</code> columns are the same, as there are no conditioning variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>lg.run_inference(debug<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Evidence       Mean Mean_inferred Variance Variance_inferred u_%change
abiotic            49.239025        49.239   58.969           46.5059          
age                25.566667       25.5667  157.911          145.6946          
cover               0.691232        0.6912    0.101            0.0814       0.0
distance           49.234583                  77.96                            
firesev                4.565         4.565     2.73            2.1678          
hetero              0.683319        0.6833    0.013            0.0116          
rich               49.233333       49.2333  228.181          117.0829          </code></pre>
</div>
</div>
<p>Let’s re-run this, but set the <code>evidence</code> to condition on stands that are 50 years old. We’ll just examine the inferred effect on fire severity, which shows a roughly 30% increase</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>lg.set_evidences({<span class="st">'age'</span>:<span class="dv">50</span>})</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>lg.run_inference(debug<span class="op">=</span><span class="va">False</span>).loc[<span class="st">'firesev'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Evidence                      
Mean                     4.565
Mean_inferred           6.0232
Variance                  2.73
Variance_inferred       2.1678
u_%change            31.942115
Name: firesev, dtype: object</code></pre>
</div>
</div>
<p>Now let’s compare this to a younger stand (which gives about a 14% decrease):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>lg.set_evidences({<span class="st">'age'</span>:<span class="dv">15</span>})</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>lg.run_inference(debug<span class="op">=</span><span class="va">False</span>).loc[<span class="st">'firesev'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Evidence                      
Mean                     4.565
Mean_inferred           3.9344
Variance                  2.73
Variance_inferred       2.1678
u_%change           -13.813984
Name: firesev, dtype: object</code></pre>
</div>
</div>
<p>As before, you can condition on multiple variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>lg.clear_evidences()</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>lg.set_evidences({<span class="st">'age'</span>:<span class="dv">50</span>, <span class="st">'distance'</span>:<span class="dv">10</span>})</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>lg.run_inference(debug<span class="op">=</span><span class="va">False</span>).loc[<span class="st">'rich'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Evidence                      
Mean                 49.233333
Mean_inferred          26.6358
Variance               228.181
Variance_inferred     117.0829
u_%change           -45.898786
Name: rich, dtype: object</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="appendix-data-files" class="level1">
<h1>Appendix: Data files</h1>
<section id="travel-survey-dataset-survey.txt" class="level2">
<h2 class="anchored" data-anchor-id="travel-survey-dataset-survey.txt">Travel survey dataset <em>survey.txt</em></h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column header</th>
<th>Variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>Age category</td>
</tr>
<tr class="even">
<td>R</td>
<td>Size of region</td>
</tr>
<tr class="odd">
<td>E</td>
<td>Education level</td>
</tr>
<tr class="even">
<td>O</td>
<td>Employment</td>
</tr>
<tr class="odd">
<td>S</td>
<td>Sex (F/M)</td>
</tr>
<tr class="even">
<td>T</td>
<td>Travel mode</td>
</tr>
</tbody>
</table>
</section>
<section id="grace-and-keeley-dataset-keeley.csv" class="level2">
<h2 class="anchored" data-anchor-id="grace-and-keeley-dataset-keeley.csv">Grace and Keeley dataset <em>keeley.csv</em></h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column header</th>
<th>Variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>distance</td>
<td>Distance to coast (m)</td>
</tr>
<tr class="even">
<td>elev</td>
<td>Elevation a.s.l.</td>
</tr>
<tr class="odd">
<td>abiotic</td>
<td>Abiotic favorability</td>
</tr>
<tr class="even">
<td>age</td>
<td>Age of stand before fire</td>
</tr>
<tr class="odd">
<td>hetero</td>
<td>Plot heterogeneity</td>
</tr>
<tr class="even">
<td>firesev</td>
<td>Severity of fire</td>
</tr>
<tr class="odd">
<td>cover</td>
<td>Cover of plants</td>
</tr>
<tr class="even">
<td>rich</td>
<td>Plant species richness</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>